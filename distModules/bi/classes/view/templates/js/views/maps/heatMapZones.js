define(["jquery","underscore","backbone","config/appConfig"],function(a,b,c,d){var e=c.View.extend({el:"#result",initialize:function(a){0===b.size(this.$("#map"))&&this.$el.append("<div id='map'></div>"),this.$map=this.$("#map"),this.data=a.chartData,this.explorers=[],this.gradientExplorers=[],this.bounds=[]},getRandomColor:function(){for(var a="0123456789ABCDEF".split(""),b="#",c=0;6>c;c++)b+=a[Math.floor(16*Math.random())];return b},getRandomGradient:function(a){var c=b.findWhere(this.gradientExplorers,{explorerName:a});if(b.isUndefined(c)){var d={explorerName:a,gradient:{.55:this.getRandomColor(),.75:this.getRandomColor()}};return this.gradientExplorers.push(d),d.gradient}return c.gradient},render:function(){this.processData(),this.renderMap(),this.renderHeatMapLayers(),this.renderLegend(),this.map.fitBounds(this.bounds)},processData:function(){var a=this;b.each(this.data,function(c){var d=c.data,e=c.group.bounds,f=c.group.groupName;if(2==b.size(e[0])&&2==b.size(e[1])&&!b.isUndefined(f)){var g=b.findWhere(a.explorers,{explorerName:f}),h=L.latLngBounds(e).getCenter(),e=[h.lat,h.lng];if(a.bounds.push(e),e.push(d),b.isUndefined(g))a.explorers.push({explorerName:f,gradient:a.getRandomGradient(f),bounds:[e]});else{var i=b.indexOf(a.explorers,g);a.explorers[i].bounds.push(e)}}})},renderMap:function(){var a=L.tileLayer(d.URL_OPENSTREETMAP,{minZoom:2,maxZoom:16});b.size(this.data)<1?this.map=new L.Map(this.$map[0],{center:new L.LatLng(30,-10),zoom:2,layers:[a]}):this.map=new L.Map(this.$map[0],{center:new L.LatLng(this.explorers[0].bounds[0][0],this.explorers[0].bounds[0][1]),zoom:10,layers:[a]})},renderHeatMapLayers:function(){var a=this;b.each(this.explorers,function(b){var c={maxZoom:12,minOpacity:.8,max:.4,blur:50,gradient:a.getRandomGradient(b.explorerName)};L.heatLayer(b.bounds,c).addTo(a.map)})},renderLegend:function(){var a=L.control({position:"bottomleft"}),c=this;a.onAdd=function(){var a=L.DomUtil.create("div","info legend");return b.each(c.explorers,function(c){var d=c.explorerName,e=b.values(c.gradient);a.innerHTML+=d+"<i style='background: linear-gradient(-45deg,"+e[1]+","+e[0]+")'></i><br/>"}),a},a.addTo(this.map)},remove:function(){this.explorers=[],this.gradientExplorers=[],this.bounds=[],this.$map.remove()}});return e});