<!DOCTYPE html>

<html>
<head>
  <title>configGroupBy.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>configGroupBy.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h3 id="group-by-configuration-file">Group By configuration file</h3>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h4 id="important">IMPORTANT</h4>
<p>In order to understand and modify this configuration file is strongly necesary to understand:</p>
<ul>
<li><a href="https://docs.mongodb.org/manual/core/aggregation-pipeline/">MongoDB Aggregation Pipeline</a></li>
<li><a href="https://docs.mongodb.org/manual/reference/operator/aggregation-pipeline/">MongoDB Aggregation Pipeline Stages</a></li>
</ul>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <ul>
<li>constants: constants module</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> constants = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./constants'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Group By configuration fields:</p>
<ul>
<li>groupByID:: group by ID</li>
<li>groupByName: group by name</li>
<li>unwind: $unwind stage configuration</li>
<li>group: $group stage configuration</li>
<li>project: $project stage configuration</li>
<li>sort: $sort stage configuration</li>
<li>projectLocation: $project stage configuration for location</li>
<li>filterCountry: $match configuration for country</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">module</span>.exports = [
    {
        groupByID: constants.GROUP_BY_RESOURCE_NAME,
        groupByName: <span class="hljs-string">'Nombre Recurso'</span>,
        group: {
            _id: <span class="hljs-string">'$metric.resource.name'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_RESOURCE_TYPE,
        groupByName: <span class="hljs-string">'Tipo Recurso'</span>,
        group: {
            _id: <span class="hljs-string">'$metric.resource.type.name'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_RESOURCE_TOPIC,
        groupByName: <span class="hljs-string">'Tematicas Recurso'</span>,
        unwind: <span class="hljs-string">'$metric.resource.topic'</span>,
        group: {
            _id: <span class="hljs-string">'$metric.resource.topic'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_RESOURCE_TERM,
        groupByName: <span class="hljs-string">'Terminos Recurso'</span>,
        unwind: <span class="hljs-string">'$metric.resource.term'</span>,
        group: {
            _id: <span class="hljs-string">'$metric.resource.term'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_GEOGRAPHIC_BOUND,
        groupByName: <span class="hljs-string">'Bound Geografico'</span>,
        group: {
            _id: {
                lat: <span class="hljs-string">'$metric.resource.location.lat'</span>,
                lng: <span class="hljs-string">'$metric.resource.location.lng'</span>
            },
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        },
        projectLocation: {
            lat: <span class="hljs-string">'$_id.lat'</span>,
            lng: <span class="hljs-string">'$_id.lng'</span>,
            data: <span class="hljs-string">'$data'</span>
        }
    },
    {
        groupByID: constants.GROUP_BY_DATE_RANGE,
        groupByName: <span class="hljs-string">'Rangos Fechas'</span>,
        project: {
            <span class="hljs-string">"year"</span>:{<span class="hljs-string">"$year"</span>:<span class="hljs-string">"$metric.metricTime"</span>},
            <span class="hljs-string">"month"</span>:{<span class="hljs-string">"$month"</span>:<span class="hljs-string">"$metric.metricTime"</span>},
            <span class="hljs-string">"dayOfMonth"</span>:{<span class="hljs-string">"$dayOfMonth"</span>:<span class="hljs-string">"$metric.metricTime"</span>},
            <span class="hljs-string">"hour"</span>:{<span class="hljs-string">"$hour"</span>:<span class="hljs-string">"$metric.metricTime"</span>}
        },
        group: {
            _id: {
                year: <span class="hljs-string">"$year"</span>,
                month: <span class="hljs-string">"$month"</span>,
                dayOfMonth: <span class="hljs-string">"$dayOfMonth"</span>,
                hour: <span class="hljs-string">"$hour"</span>
            },
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        },
        sort: {
            <span class="hljs-string">'group.year'</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">'group.month'</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">'group.dayOfMonth'</span>: <span class="hljs-number">1</span>,
            <span class="hljs-string">'group.hour'</span>: <span class="hljs-number">1</span>
        }
    },
    {
        groupByID: constants.GROUP_BY_DEVICE_TYPE,
        groupByName: <span class="hljs-string">'Tipos Dispositivo'</span>,
        group: {
            _id: <span class="hljs-string">'$device.type'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_LANGUAGE,
        groupByName: <span class="hljs-string">'Lenguaje'</span>,
        group: {
            _id: <span class="hljs-string">'$language'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_SECTION,
        groupByName: <span class="hljs-string">'Seccion'</span>,
        group: {
            _id: <span class="hljs-string">'$metric.section'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_CLIENT_LOCATION,
        groupByName: <span class="hljs-string">'Localizacion Cliente'</span>,
        group: {
            _id: <span class="hljs-string">'$remoteLocation.country'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        },
        groupRegion: {
            _id: <span class="hljs-string">'$remoteLocation.region'</span>,
            data: {
                $sum: <span class="hljs-number">1</span>
            }
        },
        filterCountry: constants.FILTER_COUNTRY
    },
    {
        groupByID: constants.GROUP_BY_EXPLORER,
        groupByName: <span class="hljs-string">'Explorador'</span>,
        group: {
            _id: <span class="hljs-string">'$metric.explorer_ID'</span>,
            data: {
                <span class="hljs-string">'$sum'</span>: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_EXPLORER_BOUNDS,
        groupByName: <span class="hljs-string">'Explorador'</span>,
        group: {
            _id: {
                bounds: <span class="hljs-string">'$metric.bounds'</span>,
                groupName: <span class="hljs-string">'$metric.explorer_ID'</span>
            },
            data: {
                <span class="hljs-string">'$sum'</span>: <span class="hljs-number">1</span>
            }
        }
    },
    {
        groupByID: constants.GROUP_BY_FILTER_BOUNDS,
        groupByName: <span class="hljs-string">'Filtros Aplicados'</span>,
        unwind: <span class="hljs-string">'$metric.filters'</span>,
        group: {
            _id: {
                bounds: <span class="hljs-string">'$metric.bounds'</span>,
                groupName: <span class="hljs-string">'$metric.filters'</span>
            },
            data: {
                <span class="hljs-string">'$sum'</span>: <span class="hljs-number">1</span>
            }
        }
    }
];</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
